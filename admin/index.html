<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../src/admin/style.css" />
    <title>システム設定 | review-gpt</title>
  </head>
  <body>
    <div id="admin-app" data-app-role="admin">
      <noscript>
        <p style="padding:1rem; text-align:center;">JavaScriptを有効にしてご利用ください。</p>
      </noscript>
      <main class="admin">
        <header class="admin__header">
          <p class="admin__badge">管理者ページ</p>
          <h1 class="admin__title">システム設定</h1>
          <p class="admin__lead">
            Gemini API キーやアンケート送信先など、セキュリティに関わる設定を編集します。ルータ／アンケート／AI プロンプトは
            <a href="/user/">ユーザー設定ページ</a>
            から調整してください。
          </p>
        </header>
        <div class="admin__menu" data-role="tab-menu-container">
          <button
            type="button"
            class="admin__menu-trigger"
            data-role="tab-menu-trigger"
            aria-expanded="false"
            aria-controls="admin-tab-menu"
            aria-label="メニュー"
          >
            <span class="sr-only">メニュー</span>
            <span class="admin__menu-icon" aria-hidden="true"></span>
          </button>
          <div class="admin__menu-panel" id="admin-tab-menu" data-role="tab-menu" aria-hidden="true">
            <nav class="admin__tabs" aria-label="設定メニュー">
              <button type="button" class="admin__tab is-active" data-tab-target="ai">システム設定</button>
              <button type="button" class="admin__tab" data-tab-target="user-data">ユーザー情報</button>
              <button type="button" class="admin__tab" data-tab-target="prompt-generator">プロンプトジェネレーター</button>
            </nav>
          </div>
        </div>
        <form id="config-form" class="admin__form">
          <section class="admin__panel is-active" data-tab-panel="ai">
            <section class="admin__card">
              <h2>トップページリンク先</h2>
              <p class="admin__hint">
                1行につき1つのURLを登録します。ルータの各ボタンは上から順番に自動案内され、末尾まで到達すると先頭に戻ります。
              </p>
              <div class="admin__fields">
                <label class="admin__field">
                  <span class="admin__field-label">アンケート1リンク</span>
                  <textarea
                    name="beginnerLinks"
                    rows="4"
                    placeholder="https://example.com/form/beginner-1"
                  ></textarea>
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">アンケート2リンク</span>
                  <textarea
                    name="intermediateLinks"
                    rows="4"
                    placeholder="https://example.com/form/intermediate-1"
                  ></textarea>
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">アンケート3リンク</span>
                  <textarea
                    name="advancedLinks"
                    rows="4"
                    placeholder="https://example.com/form/advanced-1"
                  ></textarea>
                </label>
              </div>
            </section>
            <section class="admin__card">
              <h2>口コミAI設定</h2>
              <p class="admin__hint">
                Gemini API・Googleマップの情報を設定します。保存後は口コミ生成ページに反映されます。
              </p>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">モデル名</span>
                  <input
                    type="text"
                    name="model"
                    placeholder="例: gemini-1.5-flash-latest"
                    autocomplete="off"
                  />
                  <span class="admin__field-hint">使用するGeminiモデルを指定します。未入力の場合はデフォルトモデルを利用します。</span>
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">Gemini APIキー</span>
                  <input
                    type="password"
                    name="geminiApiKey"
                    placeholder="例: AIza..."
                    autocomplete="off"
                  />
                  <span class="admin__field-hint">Gemini API のシークレットキーを入力してください。</span>
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--results">
              <h2>アンケートデータ</h2>
              <p class="admin__hint">
                各アンケートの回答取得に使う GAS アプリURL を設定します。プロンプト設定タブでは指示文のみ編集します。
              </p>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">アンケート1 GAS URL</span>
                  <input
                    type="url"
                    name="prompt_page1_gasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">アンケート2 GAS URL</span>
                  <input
                    type="url"
                    name="prompt_page2_gasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">アンケート3 GAS URL</span>
                  <input
                    type="url"
                    name="prompt_page3_gasUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                </label>
              </div>
            </section>
            <section class="admin__card admin__card--results">
              <h2>アンケート送信App</h2>
              <p class="admin__hint">アンケート1〜3の回答を保存するバックエンドappのエンドポイントを設定します。</p>
              <div class="admin__fields admin__fields--single">
                <label class="admin__field">
                  <span class="admin__field-label">送信先API(URL)</span>
                  <input
                    type="url"
                    name="surveyEndpointUrl"
                    placeholder="https://script.google.com/macros/s/.../exec"
                    autocomplete="off"
                  />
                  <span class="admin__field-hint">
                    GAS などで公開した Web API の URL。アンケート1/2/3 は回答送信時に <code>{ formKey, answers, metadata }</code> を POST します。
                  </span>
                </label>
                <label class="admin__field">
                  <span class="admin__field-label">APIキー（任意）</span>
                  <input type="text" name="surveyApiKey" placeholder="例: Bearer 用シークレット" autocomplete="off" />
                  <span class="admin__field-hint">送信時に <code>Authorization: Bearer {キー}</code> を付与します。未入力の場合はヘッダーを省略します。</span>
                </label>
              </div>
            </section>
          </section>
          <section class="admin__panel" data-tab-panel="prompt-generator">
          <section class="admin__card">
            <h2>プロンプトジェネレーター</h2>
            <p class="admin__hint">
              口コミ生成用のGemini APIと基本プロンプトを設定します。ここで入力した値は運用チーム向けのジェネレーターで利用されます。
            </p>
            <div class="admin__fields admin__fields--single">
              <label class="admin__field">
                <span class="admin__field-label">Gemini API</span>
                <input type="password" name="promptGeneratorGeminiApi" placeholder="例: AIza..." autocomplete="off" />
              </label>
              <label class="admin__field">
                <span class="admin__field-label">基本プロンプト</span>
                <textarea
                  name="promptGeneratorPrompt"
                  rows="6"
                  placeholder="口コミ生成時に利用するプロンプトを入力してください。"
                ></textarea>
              </label>
            </div>
          </section>
          <section class="admin__card">
            <h2>参考文面入力欄</h2>
            <p class="admin__hint">各コースにあわせた参考文面を保存しておくと、スタッフがすぐに呼び出せます。</p>
            <div class="admin__fields admin__fields--single">
              <label class="admin__field">
                <span class="admin__field-label">ライト</span>
                <textarea
                  name="promptGeneratorReferenceLight"
                  rows="4"
                  placeholder="短めの口コミサンプルを入力してください。"
                ></textarea>
              </label>
              <label class="admin__field">
                <span class="admin__field-label">スタンダード</span>
                <textarea
                  name="promptGeneratorReferenceStandard"
                  rows="4"
                  placeholder="スタンダード用の口コミサンプルを入力してください。"
                ></textarea>
              </label>
              <label class="admin__field">
                <span class="admin__field-label">プラチナ</span>
                <textarea
                  name="promptGeneratorReferencePlatinum"
                  rows="4"
                  placeholder="プラチナ用の口コミサンプルを入力してください。"
                ></textarea>
              </label>
            </div>
          </section>
        </section>
        <section class="admin__panel" data-tab-panel="user-data">
          <section class="admin__card">
            <h2>ユーザー情報保存先</h2>
            <p class="admin__hint">ユーザー設定ページの入力内容を保存／読み取りするGASやスプレッドシートを登録します。</p>
            <div class="admin__fields admin__fields--single">
              <label class="admin__field">
                <span class="admin__field-label">スプレッドシートURL</span>
                <input
                  type="url"
                  name="userDataSpreadsheetUrl"
                  placeholder="https://docs.google.com/spreadsheets/d/..."
                  autocomplete="off"
                />
              </label>
              <label class="admin__field">
                <span class="admin__field-label">ユーザー情報保存GASエンドポイント</span>
                <input
                  type="url"
                  name="userDataSubmitGasUrl"
                  placeholder="https://script.google.com/macros/s/xxxx/exec"
                  autocomplete="off"
                />
                <span class="admin__field-hint">ユーザー情報を保存するWebアプリURLを登録してください。</span>
              </label>
              <label class="admin__field">
                <span class="admin__field-label">ユーザー情報読み取りGAS URL</span>
                <input
                  type="url"
                  name="userDataReadGasUrl"
                  placeholder="https://script.google.com/macros/s/yyyy/exec"
                  autocomplete="off"
                />
                <span class="admin__field-hint">ユーザー情報を取得するときに利用するWebアプリURLです。</span>
              </label>
            </div>
          </section>
        </section>
          <div class="admin__floating-submit">
            <button type="submit" class="admin__submit admin__submit--floating">設定を保存</button>
          </div>
        </form>
        <p class="admin__status" data-role="status"></p>
      </main>
    </div>
    <script type="module" src="../src/admin/main.js"></script>
  </body>
</html>
